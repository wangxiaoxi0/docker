version: "3"

services:
    db:
      image: sameersbn/mysql:5.7.22-1
      ports:
        - "3306:3306"
      volumes:
        - /home/wlj/docker/redmine/mysql:/var/lib/mysql
        - /etc/localtime:/etc/localtime:ro
      environment:
        - DB_NAME=redmine_production
        - DB_USER=redmine
        - DB_PASS=password
      networks:
        - backend

    redmine1:
      image: sameersbn/redmine:3.3.8
      ports:
        - "10083:80"
      depends_on:
        - db
      volumes:
        - /etc/localtime:/etc/localtime:ro
      networks:
        - backend
        - frontend
      environment:
        - DB_ADAPTER=mysql2
        - DB_HOST=db
        - DB_PORT=3306
        - DB_NAME=redmine_production
        - DB_USER=redmine
        - DB_PASS=password

    redmine2:
      image: sameersbn/redmine:3.3.8
      ports:
        - "10084:80"
      depends_on:
        - db
      volumes:
        - /etc/localtime:/etc/localtime:ro
      networks:
        - backend
        - frontend
      environment:
        - DB_ADAPTER=mysql2
        - DB_HOST=db
        - DB_PORT=3306
        - DB_NAME=redmine_production
        - DB_USER=redmine
        - DB_PASS=password

    redmine3:
      image: sameersbn/redmine:3.3.8
      ports:
        - "10085:80"
      depends_on:
        - db
      volumes:
        - /etc/localtime:/etc/localtime:ro
      networks:
        - backend
        - frontend
      environment:
        - DB_ADAPTER=mysql2
        - DB_HOST=db
        - DB_PORT=3306
        - DB_NAME=redmine_production
        - DB_USER=redmine
        - DB_PASS=password

    nginx:
      image: wangxiaoxi/nginx_sticky:1.0
      ports:
        - "80:80"
      depends_on:
        - redmine1
        - redmine2
        - redmine3
      volumes:
        - /home/wlj/docker/redmine/nginx.conf:/etc/nginx/nginx.conf:ro
        - /home/wlj/docker/redmine/log:/var/log/nginx
        - /etc/localtime:/etc/localtime:ro
      networks:
        - frontend

networks:
  backend:
  frontend:
